<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Register test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body style="font-family:system-ui;padding:16px;background:#0b0d12;color:#e8eef8">
  <label>Functions base URL</label>
  <input id="base" placeholder="https://YOUR-REF.supabase.co/functions/v1" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b3342;background:#0f141c;color:#e8eef8"><br><br>
  <label>Full name</label>
  <input id="name" placeholder="John Doe" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b3342;background:#0f141c;color:#e8eef8"><br><br>
  <button id="btn" style="padding:12px 16px;border-radius:10px;border:1px solid #2b3342;background:#151a23;color:#e8eef8;font-weight:600">Register</button>
  <pre id="out" style="white-space:pre-wrap;word-break:break-all;background:#10141d;padding:12px;border-radius:10px;border:1px solid #2b3342;margin-top:12px">Ready… open inside Telegram</pre>
  <script>
    const tg = window.Telegram?.WebApp;
    const initData = tg?.initData || '';
    document.getElementById('btn').onclick = async () => {
      const base = document.getElementById('base').value.trim().replace(/\/+$/,'');
      const name = document.getElementById('name').value.trim();
      if (!base || !name) { alert('base URL и full name обязательны'); return; }
      try {
        const res = await fetch(`${base}/register`, {
          method: 'POST',
          headers: { 'content-type':'application/json', 'x-telegram-init-data': initData },
          body: JSON.stringify({ full_name: name })
        });
        const text = await res.text();
        document.getElementById('out').textContent = `STATUS ${res.status}\n${text}`;
      } catch (e) {
        document.getElementById('out').textContent = 'Network error: ' + (e?.message || e);
      }
    };
  </script>
</body>
</html>
